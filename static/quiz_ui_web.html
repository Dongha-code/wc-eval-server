<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>WiseCollector 2.0 ìš´ì˜ & í”„ë¡ì‹œ í•™ìŠµ ì§„ë‹¨</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f2f5;
      padding: 30px;
    }
    #quiz-box {
      background: white;
      padding: 30px;
      border-radius: 16px;
      max-width: 700px;
      margin: auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    h2 {
      margin-bottom: 10px;
      font-size: 1.5em;
    }
    input, textarea, button {
      display: block;
      margin-top: 10px;
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
    }
    button {
      background: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #status {
      margin-top: 20px;
      font-size: 0.9em;
      color: #555;
    }
    #question-number {
      font-weight: bold;
      margin-bottom: 8px;
    }
    #question-text {
      margin-bottom: 10px;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div id="quiz-box">
    <h2 id="quiz-title">WiseCollector 2.0 ìš´ì˜ & í”„ë¡ì‹œ í•™ìŠµ ì§„ë‹¨</h2>
    <div id="login-area">
      <input type="text" id="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
      <input type="email" id="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
      <button onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
    </div>
    <div id="question-area" style="display:none;">
      <div id="question-number"></div>
      <div id="question-text">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      <textarea id="answer" rows="4" placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      <button onclick="submitAnswer()">ë‹¤ìŒ ë¬¸í•­</button>
    </div>
    <div id="status"></div>
  </div>

  <script>
    let current = 0, total = 30;
    let isLoading = false;

    function startQuiz() {
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      if (!name || !email) {
        alert("ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      fetch("/api/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email })
      })
      .then(() => {
        document.getElementById("login-area").style.display = "none";
        document.getElementById("question-area").style.display = "block";
        loadNextQuestion();
      });
    }

    async function loadNextQuestion() {
      if (current >= total || isLoading) return;
      isLoading = true;

      document.getElementById("question-number").innerText = `(${current + 1}/${total})`;
      document.getElementById("question-text").innerText = "ğŸ”„ ë¬¸ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...";

      try {
        const res = await fetch("/api/next-question");
        const q = await res.json();

        if (!q || !q.question || q.question === "undefined") {
          document.getElementById("question-text").innerText = "âŒ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
        } else {
          document.getElementById("question-text").innerText = q.question;
          document.getElementById("answer").value = "";
        }
      } catch (e) {
        document.getElementById("question-text").innerText = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${e.message}`;
      }

      isLoading = false;
    }

    function submitAnswer() {
      const answer = document.getElementById("answer").value;
      if (!answer) {
        alert("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      fetch("/api/submit-answer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answer })
      })
      .then(res => res.json())
      .then(() => {
        current++;
        if (current >= total) {
          document.getElementById("question-text").innerText = "ëª¨ë“  ë¬¸í•­ ì™„ë£Œ. ê²°ê³¼ë¥¼ ìƒì„± ì¤‘...";
          fetch("/api/report")
            .then(res => res.json())
            .then(data => {
              document.getElementById("status").innerText = `âœ… ê²°ê³¼ ì „ì†¡ ì™„ë£Œ: ${JSON.stringify(data)}`;
            });
        } else {
          loadNextQuestion();
        }
      });
    }
  </script>
</body>
</html>
